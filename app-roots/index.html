<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roots and Powers Exercise - Ages 10-16</title>
    <link rel="stylesheet" href="../shared-styles.css" />
    <style>
      /* Additional styles specific to roots challenge */
      .problem-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      @media (min-width: 768px) {
        .problem-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .problem-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 2px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .problem-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        border-color: var(--color-math-purple);
      }

      .problem-label {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        color: var(--color-math-purple);
        display: inline-block;
        width: 2.5rem;
        height: 2.5rem;
        background: linear-gradient(135deg, var(--bg-light-blue), var(--bg-light-purple));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
      }

      .problem-expression {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-math-blue);
        font-family: var(--font-handwriting);
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
      }

      .input-field {
        padding: 0.75rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-family: var(--font-body);
        font-size: 1.1rem;
        transition: all 0.2s ease;
      }

      .input-field:focus {
        outline: none;
        border-color: var(--color-math-purple);
        box-shadow: 0 0 0 3px rgba(123, 104, 238, 0.1);
      }

      .button-group {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      .btn {
        font-family: var(--font-body);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1rem;
      }

      .btn-check {
        background: linear-gradient(135deg, var(--color-math-green), #27ae60);
        color: white;
        flex: 1;
        min-width: 120px;
      }

      .btn-check:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: var(--shadow-md);
      }

      .btn-check:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .feedback-item {
        border-radius: 12px;
        padding: 1rem;
        margin-top: 1rem;
        border-left: 5px solid;
        font-family: var(--font-body);
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-10px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .feedback-correct {
        background: var(--bg-light-green);
        border-color: var(--color-math-green);
        color: #1b5e20;
      }

      .feedback-incorrect {
        background: #ffebee;
        border-color: var(--color-math-pink);
        color: #b71c1c;
      }

      .feedback-failed {
        background: var(--bg-light-orange);
        border-color: var(--color-math-orange);
        color: #e65100;
      }

      .feedback-icon {
        font-size: 1.5rem;
        margin-right: 0.5rem;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Back to Home Button -->
    <a href="../index.html" class="btn-back-home"> Home Menu </a>

    <!-- Decorative Doodles -->
    <div class="doodle doodle-1">‚àö</div>
    <div class="doodle doodle-2">¬≤</div>
    <div class="doodle doodle-3">¬≥</div>
    <div class="doodle doodle-4">‚àõ</div>

    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1>ROOTS AND POWERS</h1>
        <p class="subtitle">Calculate the value of each radical expression!</p>
      </header>

      <!-- Main Card -->
      <div class="card">
        <!-- Exercise Container -->
        <div id="exerciseContainer" class="problem-grid">
          <!-- Problems will be generated here -->
        </div>

        <!-- Controls -->
        <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
          <button
            onclick="loadExercise()"
            id="newExerciseButton"
            class="btn btn-primary"
          >
            üîÑ New Exercise
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- Problem Definition and Correct Answers ---
      // Note: Problems 'e' and 'j' have been adjusted to positive numbers (32 and 243)
      // to comply with the requirement of "positive numbers only".
      const problemsData = [
        { id: "a", expression: "‚àö144", correct: 12, label: "a" },
        { id: "b", expression: "¬≥‚àö343", correct: 7, label: "b" },
        { id: "c", expression: "‚Å¥‚àö16", correct: 2, label: "c" },
        { id: "d", expression: "‚Å¥‚àö625", correct: 5, label: "d" },
        { id: "e", expression: "‚Åµ‚àö32", correct: 2, label: "e" },
        { id: "f", expression: "‚Åµ‚àö100 000", correct: 10, label: "f" },
        { id: "g", expression: "‚Å¥‚àö6561", correct: 9, label: "g" },
        { id: "h", expression: "‚Å∂‚àö64", correct: 2, label: "h" },
        { id: "i", expression: "¬π‚Å∞‚àö1024", correct: 2, label: "i" },
        { id: "j", expression: "‚Åµ‚àö243", correct: 3, label: "j" },
      ];

      const exerciseContainer = document.getElementById("exerciseContainer");
      // Object to track failed attempts for each problem: { 'a': 0, 'b': 0, ... }
      let attemptCounters = {};
      const MAX_ATTEMPTS = 3;

      /**
       * Checks the student's answer for a specific problem.
       * @param {string} problemId - The ID of the problem (e.g., 'a', 'b').
       * @param {number} correctAnswer - The expected correct answer.
       */
      function checkAnswer(problemId, correctAnswer) {
        const inputElement = document.getElementById(`input-${problemId}`);
        const feedbackElement = document.getElementById(
          `feedback-${problemId}`
        );
        const checkButton = document.getElementById(`check-btn-${problemId}`);

        // Check if the input is disabled (already solved or max attempts reached)
        if (inputElement.disabled) {
          return;
        }

        const userAnswer = parseInt(inputElement.value.trim(), 10);

        // Clear the previous feedback class and prepare the element.
        feedbackElement.classList.remove(
          "feedback-correct",
          "feedback-incorrect",
          "feedback-failed",
          "hidden"
        );

        if (isNaN(userAnswer) || inputElement.value.trim() === "") {
          feedbackElement.innerHTML = '<span class="feedback-icon">‚ö†Ô∏è</span>Please enter a number.';
          feedbackElement.classList.add("feedback-incorrect");
          feedbackElement.classList.remove("hidden");
          return;
        }

        if (userAnswer === correctAnswer) {
          // Correct Answer
          feedbackElement.innerHTML = '<span class="feedback-icon">‚úÖ</span>Correct!';
          feedbackElement.classList.add("feedback-correct");
          inputElement.disabled = true; // Disable input if correct
          checkButton.disabled = true; // Disable button
        } else {
          // Incorrect Answer

          // Increment the counter for this problem
          attemptCounters[problemId] = (attemptCounters[problemId] || 0) + 1;

          const attemptsLeft = MAX_ATTEMPTS - attemptCounters[problemId];

          if (attemptsLeft > 0) {
            // Try again
            feedbackElement.innerHTML = `<span class="feedback-icon">‚ùå</span>Incorrect. Attempts remaining: ${attemptsLeft}`;
            feedbackElement.classList.add("feedback-incorrect");
          } else {
            // Max attempts reached: reveal the answer
            feedbackElement.innerHTML = `<span class="feedback-icon">üìç</span>Maximum attempts reached. The correct answer is <strong>${correctAnswer}</strong>.`;
            feedbackElement.classList.add("feedback-failed");
            inputElement.disabled = true; // Disable input
            checkButton.disabled = true; // Disable button
          }
        }

        // Show the feedback element
        feedbackElement.classList.remove("hidden");
      }

      /**
       * Loads and renders all problems in the container.
       */
      function loadExercise() {
        exerciseContainer.innerHTML = ""; // Clear the container
        attemptCounters = {}; // Reset all attempt counters

        problemsData.forEach((problem) => {
          // Initialize counter for this problem
          attemptCounters[problem.id] = 0;

          const problemCard = document.createElement("div");
          problemCard.className = "problem-card";

          // Build HTML for each problem
          problemCard.innerHTML = `
            <div style="margin-bottom: 1rem;">
              <span class="problem-label">${problem.label}</span>
              <div class="problem-expression" style="margin-top: 0.75rem;">
                ${problem.expression}
              </div>
            </div>
            
            <div class="input-group">
              <input 
                type="number" 
                id="input-${problem.id}" 
                placeholder="Write your answer" 
                class="input-field"
              />
              <div style="display: flex; gap: 0.75rem;">
                <button 
                  id="check-btn-${problem.id}"
                  class="btn btn-check"
                  onclick="checkAnswer('${problem.id}', ${problem.correct})"
                >
                  Check
                </button>
              </div>
            </div>

            <!-- Feedback Container (initially empty/hidden) -->
            <div id="feedback-${problem.id}" class="feedback-item hidden">
              <!-- Feedback will be inserted here -->
            </div>
          `;

          exerciseContainer.appendChild(problemCard);
        });

        // Change the control button text
        document.getElementById("newExerciseButton").textContent =
          "üîÑ New Exercise";
      }

      // --- Initialization ---
      window.onload = loadExercise;
    </script>
  </body>
</html>
