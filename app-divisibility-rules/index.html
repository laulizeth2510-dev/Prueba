<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comprobador Did√°ctico de M√∫ltiplos (Feedback Inmediato)</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Estilos personalizados para la animaci√≥n de la caja de resultados */
      @keyframes fadeInSlide {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-result-card {
        animation: fadeInSlide 0.3s ease-out;
      }
      .quiz-option {
        transition: all 0.2s;
      }
      .quiz-option:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -2px rgba(0, 0, 0, 0.1);
      }
      .selected-yes {
        background-color: #3b82f6 !important; /* blue-500 */
        color: white !important;
        border-color: #1e40af !important; /* blue-800 */
      }
      .selected-no {
        background-color: #f87171 !important; /* red-400 */
        color: white !important;
        border-color: #b91c1c !important; /* red-800 */
      }
      /* Estilo para los botones deshabilitados despu√©s de la respuesta */
      .quiz-option:disabled {
        cursor: not-allowed;
        opacity: 0.7;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 min-h-screen flex items-center justify-center p-4 font-sans"
  >
    <!-- Back to Home Button -->
    <a
      href="../index.html"
      style="
        position: fixed;
        top: 20px;
        left: 20px;
        background: white;
        color: #7b68ee;
        border: 3px solid #7b68ee;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 16px rgba(123, 104, 238, 0.2);
        transition: all 0.3s ease;
        z-index: 1000;
      "
    >
      ‚Üê Men√∫ Principal
    </a>

    <div
      class="w-full max-w-xl bg-white shadow-2xl rounded-2xl p-6 md:p-10 border border-blue-200"
    >
      <h1 class="text-3xl font-extrabold text-blue-800 mb-2 text-center">
        M√∫ltiplos en el Aula: Modo Feedback Inmediato
      </h1>
      <p class="text-gray-500 mb-6 text-center text-lg">
        Selecciona S√ç o NO para cada criterio. ¬°La retroalimentaci√≥n es
        instant√°nea!
      </p>

      <!-- N√∫mero a Analizar -->
      <div
        class="text-center mb-6 p-4 border-2 border-indigo-400 bg-indigo-50 rounded-xl shadow-inner"
      >
        <p class="text-sm font-medium text-indigo-700 mb-1">
          N√∫mero a Analizar
        </p>
        <div
          id="randomNumberDisplay"
          class="text-6xl font-black text-indigo-900 leading-none"
        >
          ...
        </div>
      </div>

      <!-- Opciones de Quiz -->
      <div id="quizOptions" class="space-y-3 mb-6">
        <!-- Las opciones del quiz se generar√°n aqu√≠ -->
      </div>

      <!-- Controles -->
      <div class="flex space-x-4 mb-8">
        <button
          onclick="generateNewNumber()"
          id="newNumberButton"
          class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-extrabold py-3 rounded-xl transition duration-150 ease-in-out transform hover:scale-[1.01] shadow-xl shadow-blue-300 uppercase tracking-wider"
        >
          Nuevo N√∫mero
        </button>
      </div>

      <!-- √Årea de Resultados / Feedback -->
      <!-- Se dividir√° en dos secciones para la lista de feedback individual y el score final -->
      <div id="feedbackListContainer" class="mt-8 space-y-4">
        <!-- El feedback individual se insertar√° aqu√≠ -->
      </div>

      <div id="finalScoreContainer" class="mt-8">
        <!-- El score final se insertar√° aqu√≠ -->
      </div>
    </div>

    <script>
      // --- Variables de Estado del Quiz ---
      let currentNumber = 0;
      let checksData = []; // Almacena el resultado de getDivisibilityRules()
      let userAnswers = {}; // {2: null, 3: null, ...}
      const divisors = [2, 3, 5, 6, 7, 9, 10];

      // Referencias a elementos del DOM
      const randomNumberDisplay = document.getElementById(
        "randomNumberDisplay"
      );
      const quizOptionsContainer = document.getElementById("quizOptions");
      const feedbackListContainer = document.getElementById(
        "feedbackListContainer"
      );
      const finalScoreContainer = document.getElementById(
        "finalScoreContainer"
      );

      // Variables para el seguimiento del estado
      let answersCount = 0;
      let correctCount = 0;

      // --- Utilidades ---

      /**
       * Calcula la suma de los d√≠gitos de un n√∫mero (valor absoluto).
       */
      function getSumOfDigits(num) {
        return String(Math.abs(num))
          .split("")
          .map(Number)
          .reduce((sum, digit) => sum + digit, 0);
      }

      /**
       * Genera las reglas de divisibilidad y las respuestas correctas.
       */
      function getDivisibilityRules(num) {
        const absNumber = Math.abs(num);
        const sumOfDigits = getSumOfDigits(num);
        const lastDigit = absNumber % 10;

        return [
          {
            divisor: 2,
            isMultiple: absNumber % 2 === 0,
            rule: `El n√∫mero ${absNumber} termina en ${lastDigit}. Para ser m√∫ltiplo de 2, el √∫ltimo d√≠gito debe ser 0, 2, 4, 6 u 8.`,
            icon: "üî¢",
          },
          {
            divisor: 3,
            isMultiple: sumOfDigits % 3 === 0,
            rule: `La suma de sus d√≠gitos es ${sumOfDigits}. Para ser m√∫ltiplo de 3, la suma de sus d√≠gitos (${sumOfDigits}) debe ser divisible por 3.`,
            icon: "‚ûï",
          },
          {
            divisor: 5,
            isMultiple: lastDigit === 0 || lastDigit === 5,
            rule: `El n√∫mero ${absNumber} termina en ${lastDigit}. Para ser m√∫ltiplo de 5, el √∫ltimo d√≠gito debe ser 0 o 5.`,
            icon: "‚úã",
          },
          {
            divisor: 6,
            isMultiple: absNumber % 2 === 0 && sumOfDigits % 3 === 0,
            rule: `Debe ser m√∫ltiplo de 2 Y de 3 a la vez. Comprueba si se cumplen las reglas de divisibilidad para el 2 y el 3.`,
            icon: "üîÑ",
          },
          {
            divisor: 7,
            isMultiple: absNumber % 7 === 0,
            rule: `La forma m√°s sencilla es dividir ${absNumber} entre 7. Regla: Restar el doble del √∫ltimo d√≠gito al n√∫mero restante; el resultado debe ser divisible por 7.`,
            icon: "‚≠ê",
          },
          {
            divisor: 9,
            isMultiple: sumOfDigits % 9 === 0,
            rule: `La suma de sus d√≠gitos es ${sumOfDigits}. Para ser m√∫ltiplo de 9, la suma de sus d√≠gitos (${sumOfDigits}) debe ser divisible por 9.`,
            icon: "‚ú®",
          },
          {
            divisor: 10,
            isMultiple: lastDigit === 0,
            rule: `El n√∫mero ${absNumber} termina en ${lastDigit}. Para ser m√∫ltiplo de 10, el √∫ltimo d√≠gito debe ser 0.`,
            icon: "üîü",
          },
        ];
      }

      // --- L√≥gica del Quiz ---

      /**
       * Renderiza la tarjeta de feedback individual para un divisor.
       * @param {number} divisor - El divisor comprobado.
       */
      function renderIndividualFeedback(divisor) {
        const check = checksData.find((c) => c.divisor === divisor);
        const userAnswer = userAnswers[divisor];
        const isCorrect = userAnswer === check.isMultiple;

        if (isCorrect) correctCount++;
        answersCount++;

        const colorClass = isCorrect
          ? "border-green-500 bg-green-50"
          : "border-red-500 bg-red-50";
        const resultText = isCorrect ? "¬°Correcto!" : "¬°Incorrecto!";
        const feedbackIcon = isCorrect ? "‚úÖ" : "‚ùå";
        const correctLabel = check.isMultiple
          ? "S√ç es m√∫ltiplo"
          : "NO es m√∫ltiplo";

        const feedbackItem = document.createElement("li");
        feedbackItem.className = `p-4 rounded-xl border-l-4 shadow-md animate-result-card transition-all duration-300 ${colorClass}`;
        feedbackItem.id = `feedback-${divisor}`;
        feedbackItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        ${feedbackIcon} M√∫ltiplo de ${divisor}
                    </h3>
                    <span class="text-lg font-extrabold px-3 py-1 rounded-full ${
                      isCorrect
                        ? "bg-green-600 text-white"
                        : "bg-red-600 text-white"
                    }">
                        ${resultText}
                    </span>
                </div>
                <p class="mt-2 text-gray-700">
                    <span class="font-semibold text-blue-700">Tu Respuesta:</span> ${
                      userAnswer ? "S√ç" : "NO"
                    }
                    <span class="ml-4 font-semibold text-blue-700">Respuesta Correcta:</span> ${correctLabel}
                </p>
                <p class="mt-1 text-gray-600 border-t border-gray-200 pt-2">
                    <span class="font-semibold text-blue-700">Regla Did√°ctica:</span> ${
                      check.rule
                    }
                </p>
            `;
        feedbackListContainer.appendChild(feedbackItem);

        // Si todas las respuestas han sido dadas, mostrar el puntaje final
        if (answersCount === divisors.length) {
          displayFinalScore();
        }
      }

      /**
       * Muestra el resumen del puntaje final.
       */
      function displayFinalScore() {
        const totalChecks = divisors.length;
        const scoreMessage = `Puntaje Final: ${correctCount} de ${totalChecks} (${(
          (correctCount / totalChecks) *
          100
        ).toFixed(0)}%)`;

        const scoreBox = document.createElement("div");
        scoreBox.className =
          "text-center p-4 mb-6 bg-blue-100 border-2 border-blue-400 rounded-xl shadow-lg animate-result-card";
        scoreBox.innerHTML = `<h2 class="text-2xl font-black text-blue-800">${scoreMessage}</h2>`;

        finalScoreContainer.appendChild(scoreBox);
      }

      /**
       * Selecciona la respuesta del usuario, da feedback individual e inicia la comprobaci√≥n final si es necesario.
       * @param {number} divisor - El divisor al que se aplica la respuesta.
       * @param {boolean} answer - La respuesta del usuario (true = S√ç, false = NO).
       * @param {HTMLElement} btnYes - Bot√≥n S√ç.
       * @param {HTMLElement} btnNo - Bot√≥n NO.
       */
      function selectAnswer(divisor, answer, btnYes, btnNo) {
        // Si ya tiene una respuesta registrada (y los botones est√°n deshabilitados), no hacer nada
        if (userAnswers[divisor] !== null) return;

        userAnswers[divisor] = answer;

        // L√≥gica de selecci√≥n visual
        if (answer === true) {
          btnYes.classList.add("selected-yes");
        } else {
          btnNo.classList.add("selected-no");
        }

        // Deshabilitar botones para este criterio una vez respondido
        btnYes.disabled = true;
        btnNo.disabled = true;

        // Dar feedback inmediato
        renderIndividualFeedback(divisor);
      }

      /**
       * Genera un nuevo n√∫mero aleatorio y resetea el quiz.
       */
      function generateNewNumber() {
        // Generar un n√∫mero aleatorio entre 1 y 1000 (excluyendo el 0)
        currentNumber = Math.floor(Math.random() * 999) + 1;

        // Resetear estado y contadores
        userAnswers = {};
        answersCount = 0;
        correctCount = 0;
        feedbackListContainer.innerHTML = "";
        finalScoreContainer.innerHTML = "";

        // Actualizar la UI
        randomNumberDisplay.textContent = currentNumber;

        // Calcular y almacenar las reglas y respuestas correctas
        checksData = getDivisibilityRules(currentNumber);
        renderQuizOptions(checksData);
      }

      /**
       * Renderiza los botones de S√ç/NO para cada divisor.
       * @param {Array} checks - Lista de divisores y reglas.
       */
      function renderQuizOptions(checks) {
        quizOptionsContainer.innerHTML = "";

        checks.forEach((check) => {
          const divisor = check.divisor;

          // Inicializar respuesta del usuario
          userAnswers[divisor] = null;

          const optionDiv = document.createElement("div");
          optionDiv.className =
            "flex items-center justify-between p-3 bg-gray-100 rounded-xl shadow-inner";

          optionDiv.innerHTML = `
                    <span class="text-lg font-semibold text-gray-700 flex items-center">
                        ${check.icon} &nbsp; ¬øM√∫ltiplo de <span class="text-2xl ml-1 mr-2 font-black">${divisor}</span>?
                    </span>
                    <div class="flex space-x-2">
                        <button id="btnYes${divisor}" class="quiz-option px-4 py-2 font-bold rounded-lg border-2 border-gray-300 text-gray-700 bg-white" data-answer="true">S√ç</button>
                        <button id="btnNo${divisor}" class="quiz-option px-4 py-2 font-bold rounded-lg border-2 border-gray-300 text-gray-700 bg-white" data-answer="false">NO</button>
                    </div>
                `;

          quizOptionsContainer.appendChild(optionDiv);

          // Asignar listeners despu√©s de adjuntar al DOM
          const btnYes = document.getElementById(`btnYes${divisor}`);
          const btnNo = document.getElementById(`btnNo${divisor}`);

          // Usamos bind para pasar los par√°metros correctos al selectAnswer
          btnYes.onclick = selectAnswer.bind(
            null,
            divisor,
            true,
            btnYes,
            btnNo
          );
          btnNo.onclick = selectAnswer.bind(
            null,
            divisor,
            false,
            btnYes,
            btnNo
          );
        });
      }

      // --- Inicializaci√≥n ---
      window.onload = () => {
        generateNewNumber();
      };
    </script>
  </body>
</html>
